{% extends "main_template.html" %}
{% load staticfiles%}

{% block content %}
    <button class="btn btn-grey"><a href="/main_app">Назад ко всем событиям</a></button>
    <div class="content">
        <form method="post" enctype="multipart/form-data" id="event_form_edit" novalidate>
            {% csrf_token %}
            {% include 'includes/bootstrap4_form.html' with form=form %}
            <div class="form-group">
                <label>Категории</label>
                <span id="categories" class="custom_multiply_select">
                    {% for category in selected_categories %}
                        <span class="remove_categories" data-categories_id="{{ category.id }}"
                              data-categories_description="{{ category.description }}">{{ category.name }}</span>
                    {% endfor %}
                </span>
                <div class="custom_multiply_select_items" style="display: inline-grid;">
                    {% for category in categories %}
                        <span class="multiply_select_item" data-categories_id="{{ category.id }}"
                              data-categories_description="{{ category.description }}">{{ category.name }}</span>
                    {% endfor %}
                </div>
            </div>
            <div class="form-group ">
                <select id="select-state" name="select_city" placeholder="Начните вводить...">
                </select>
            </div>
            <div class="form-group">
                <label>Выберите место</label>
                <span class="select_bounds_yamaps">{{ geo_point.name }}</span>
                <div id="map" style="width: 600px; height: 300px"></div>
            </div>
            <button type="submit" class="btn btn-primary">Submit</button>
        </form>

        {% if active == '3' %}
            <button class="restore_or_delete_event" data-is_restore="true">Восстановить событие</button>
        {% else %}
            <button class="restore_or_delete_event" data-is_restore="false">Удалить событие</button>
        {% endif %}
    </div>

    <script>

        $.ajax({
            url: '/cities_/get_cities_for_event',
            type: 'GET',
            data: {
                'event_city': {{ user_city.city_id }}
            },
            success: function (data) {
                if (data) {
                    $('#select-state').html(data).selectize();
                } else {
                    // TODO заполнить error
                }
            }
        });
        let $active= $('#id_active');
        $active.removeClass('form-control');
        $active.selectize();
        $active.siblings('.selectize-control').css('padding-bottom', '15px');

        var is_create = false,
            is_edit = true,
            is_view = false,
            geo_lat ='{{ geo_point.lat }}',
            geo_lng ='{{ geo_point.lng }}',
            event_map = false;
    </script>
    <script type="text/javascript" src="{% static 'js/yamap.js' %}"></script>

    <div id="dialog_confirm" data-event_id="{{ id }}"></div>
{% endblock %}